extends ../layouts/main

block content
  div(class="max-w-2xl mx-auto")
    // Encabezado
    div(class="mb-6")
      h2(class="text-2xl font-bold text-gray-800") Asignación de Cama
      p(class="text-gray-600") Seleccione un paciente para internar.

    // --- BLOQUE DE ERROR AGREGADO ---
    if error
      div(class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert")
        p(class="font-bold") Error de Asignación
        p= error
    // --------------------------------

    div(class="bg-white shadow-lg rounded-lg overflow-hidden")
      // Cabecera con Info de la Cama
      div(class="bg-blue-600 px-6 py-4")
        h3(class="text-white text-lg font-bold") 
          | Habitación #{cama.numero_habitacion} - Cama #{cama.numero_cama}
        p(class="text-blue-100 text-sm") Tipo: #{cama.tipo}

      // Formulario
      div(class="p-6")
        form(action="/internacion/asignar" method="POST")
          // Campo Oculto para el ID de la cama
          input(type="hidden" name="cama_id" value=cama.id)

          // Selección de Paciente
          div(class="mb-6")
            label(class="block text-sm font-medium text-gray-700 mb-2") Seleccionar Paciente
            if pacientes.length > 0
              select(name="paciente_id" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border")
                option(value="" disabled selected) -- Buscar paciente disponible --
                each p in pacientes
                  // Mostramos el sexo en el dropdown para ayudar al usuario
                  option(value=p.id) #{p.nombre} #{p.apellido} (DNI: #{p.dni}) - Sexo: #{p.sexo}
            else
              div(class="bg-yellow-50 border-l-4 border-yellow-400 p-4")
                p(class="text-yellow-700") No hay pacientes disponibles para internar (todos tienen internación activa o no hay registros).
                a(href="/admision/nuevo" class="text-blue-600 underline mt-2 block") Registrar nuevo paciente

          // Motivo de Internación
          div(class="mb-6")
            label(class="block text-sm font-medium text-gray-700 mb-2") Motivo de Internación
            textarea(name="motivo" required rows="3" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border" placeholder="Diagnóstico presuntivo, observaciones, etc.")

          // Botones
          div(class="flex justify-end pt-4")
            a(href="/habitaciones" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded mr-2 hover:bg-gray-300") Cancelar
            if pacientes.length > 0
              button(type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg") Confirmar Internación