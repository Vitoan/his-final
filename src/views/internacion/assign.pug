extends ../layouts/main

block content
  // --- HEADER DE NAVEGACI√ìN ---
  div(class="max-w-3xl mx-auto mb-8")
    div(class="flex flex-col md:flex-row md:items-end justify-between gap-6")
      div
        h2(class="text-xs font-bold text-blue-500 dark:text-blue-400 mb-1 tracking-widest uppercase") Gesti√≥n de Camas
        h1(class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white")
          | Asignar <span class="text-blue-600 dark:text-blue-500">Paciente</span>
      
      a(href="/habitaciones" class="flex items-center gap-2 text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-white font-bold text-sm transition-colors")
        span &larr;
        | Cancelar y Volver

  // --- TARJETA BENTO ---
  div(class="max-w-3xl mx-auto bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-[2rem] shadow-xl overflow-hidden")

    // 1. Cabecera de la Cama (Contexto)
    div(class="bg-blue-50 dark:bg-blue-900/20 p-8 border-b border-blue-100 dark:border-blue-800 flex items-center gap-6")
       div(class="w-16 h-16 rounded-2xl bg-blue-600 text-white flex items-center justify-center text-3xl shadow-lg shadow-blue-500/30")
          | üõèÔ∏è
       
       div
          h2(class="text-2xl font-bold text-slate-900 dark:text-white") Habitaci√≥n #{cama.Habitacion ? cama.Habitacion.numero : 'Generica'}
          div(class="flex gap-2 mt-1")
             span(class="px-2 py-0.5 rounded bg-white dark:bg-slate-800 text-blue-700 dark:text-blue-300 text-xs font-bold border border-blue-200 dark:border-blue-700") Cama #{cama.numero_cama}
             span(class="px-2 py-0.5 rounded bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs font-bold border border-slate-200 dark:border-slate-700 uppercase") #{cama.Habitacion ? cama.Habitacion.tipo : ''}

    // 2. Alerta de Error (Si existe)
    if error
      div(class="mx-8 mt-8 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-300 p-4 rounded-xl flex items-center shadow-sm animate-pulse")
         span(class="mr-3 text-2xl") ‚ö†Ô∏è
         div
           p(class="font-bold text-sm") No se pudo realizar la asignaci√≥n
           p(class="text-xs") #{error}

    // 3. Formulario
    div(class="p-8")
      form(action="/internacion/asignar" method="POST" class="space-y-8")
        input(type="hidden" name="cama_id" value=cama.id)

        // SELECCI√ìN DE PACIENTE
        div
          label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3") Seleccionar Paciente
          
          if pacientes.length > 0
            div(class="relative group")
              select(name="paciente_id" required class="w-full px-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent outline-none transition-all dark:text-white appearance-none cursor-pointer shadow-sm")
                option(value="" disabled selected) -- Buscar paciente en lista de espera --
                each p in pacientes
                  // Agregamos un indicador visual simple para el sexo en el texto
                  option(value=p.id) [#{p.sexo}] #{p.apellido}, #{p.nombre} (DNI: #{p.dni})
              
              // Icono Flecha
              div(class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-slate-500")
                 svg(class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                    path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7")
            
            p(class="mt-2 text-xs text-slate-400") * Solo se muestran pacientes que NO est√°n internados actualmente.

          else
            // EMPTY STATE (Si no hay pacientes)
            div(class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6 text-center")
              div(class="text-3xl mb-2") üìÇ
              h3(class="text-amber-800 dark:text-amber-200 font-bold mb-1") No hay pacientes disponibles
              p(class="text-amber-700 dark:text-amber-300 text-sm mb-4") Todos los pacientes registrados ya tienen una internaci√≥n activa o no hay pacientes en el sistema.
              a(href="/admision/nuevo" class="inline-block bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors")
                | + Registrar Nuevo Paciente

        // MOTIVO DE INTERNACI√ìN
        div
          label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3") Motivo de Internaci√≥n
          textarea(name="motivo" required rows="3" placeholder="Escriba el diagn√≥stico presuntivo o motivo de ingreso..." class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent outline-none transition-all dark:text-white resize-none shadow-sm")

        // BOTONES DE ACCI√ìN
        div(class="pt-4 flex items-center justify-end gap-4 border-t border-slate-100 dark:border-slate-700")
          a(href="/habitaciones" class="px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-bold transition-colors text-sm") 
             | Cancelar
          
          if pacientes.length > 0
            button(type="submit" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-3 rounded-xl hover:bg-slate-800 dark:hover:bg-slate-200 font-bold shadow-lg shadow-slate-500/20 transition-all transform active:scale-95 text-sm flex items-center gap-2")
               span üè•
               | Confirmar Internaci√≥n