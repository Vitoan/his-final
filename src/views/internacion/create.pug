extends ../layouts/main

block content
  div(class="max-w-4xl mx-auto")
    
    div(class="mb-8")
      a(href="/mesa-entrada" class="text-slate-500 hover:text-slate-800 mb-4 inline-block") â† Volver a Guardia
      h1(class="text-3xl font-bold text-slate-900 dark:text-white") Nueva InternaciÃ³n
      p(class="text-slate-500 dark:text-slate-400") AsignaciÃ³n de cama para paciente de Guardia.

    form(action="/internacion/nuevo" method="POST" class="space-y-8")
      
      // 1. INFO PACIENTE
      div(class="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-2xl border border-blue-100 dark:border-blue-800 flex items-center justify-between")
        div(class="flex items-center gap-4")
          div(class="w-14 h-14 rounded-full bg-blue-600 text-white flex items-center justify-center text-xl font-bold shadow-lg") #{paciente.sexo}
          div
            h2(class="text-xl font-bold text-slate-900 dark:text-white") #{paciente.nombre} #{paciente.apellido}
            p(class="text-blue-600 dark:text-blue-300 text-sm") DNI: #{paciente.dni} â€¢ Sexo: #{paciente.sexo === 'M' ? 'Masculino' : 'Femenino'}
        input(type="hidden" name="paciente_id" value=paciente.id)

      // 2. SELECTOR DE CAMAS
      div
        h3(class="text-lg font-bold text-slate-900 dark:text-white mb-4") Seleccione una Cama Disponible
        
        if camas.length > 0
          div(class="grid grid-cols-2 md:grid-cols-3 gap-4")
            each cama in camas
              label(class=`relative group ${cama.incompatible ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`)
                input(
                  type="radio" 
                  name="cama_id" 
                  value=cama.id 
                  required 
                  disabled=cama.incompatible 
                  class="peer sr-only"
                )
                
                div(class=`p-4 rounded-xl border-2 transition-all ${cama.incompatible ? 'bg-slate-100 border-slate-200' : 'bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 peer-checked:border-indigo-600 peer-checked:bg-indigo-50 dark:peer-checked:bg-indigo-900/20'}`)
                  div(class="flex justify-between items-start mb-2")
                    span(class="text-[10px] font-bold uppercase text-slate-400") Hab. #{cama.Habitacion.numero}
                    if cama.incompatible
                      span(class="bg-red-100 text-red-600 text-[9px] px-1.5 py-0.5 rounded font-bold border border-red-200") ğŸš» Sexo
                    else
                      span(class="text-green-500 text-[10px] font-bold") â— Disponible
                  
                  div(class=`text-lg font-bold ${cama.incompatible ? 'text-slate-400' : 'text-slate-900 dark:text-white'}`) Cama #{cama.numero_cama}
                  
                  if cama.incompatible
                    p(class="text-[9px] text-red-500 mt-1 font-medium") HabitaciÃ³n ocupada por sexo opuesto.
                  else
                    p(class="text-[10px] text-slate-500") #{cama.Habitacion.tipo}

        else
          div(class="p-10 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 text-center")
            p(class="text-slate-500 font-medium") No hay camas disponibles actualmente.

      // 3. DATOS MÃ‰DICOS
      div(class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm")
        label(class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2") DiagnÃ³stico / Motivo de InternaciÃ³n
        textarea(name="diagnostico" rows="3" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:bg-slate-900 dark:border-slate-600 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Describa el motivo del ingreso..." required)

      button(type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:bg-slate-300 disabled:shadow-none" disabled=camas.every(c => c.incompatible)) 
        | ğŸ›ï¸ Confirmar InternaciÃ³n