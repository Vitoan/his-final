extends ../layouts/main

block content
  div(class="max-w-4xl mx-auto")
    // Encabezado
    div(class="flex items-center justify-between mb-6")
      // Título dinámico
      h2(class="text-2xl font-bold text-gray-800") #{isEditing ? 'Editar Paciente' : 'Registrar Nuevo Paciente'}
      a(href="/admision" class="text-blue-600 hover:text-blue-800") &larr; Volver al listado

    // Mensaje de Error
    if error
      div(class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert")
        p(class="font-bold") Error
        p= error

    // Formulario
    div(class="bg-white shadow-md rounded-lg p-6")
      // La acción del formulario cambia dinámicamente según si editamos o creamos
      form(action=isEditing ? '/admision/editar/' + data.id : '/admision/nuevo' method="POST")
        
        h3(class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2") Datos Personales
        
        div(class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6")
          // Nombre
          div
            label(class="block text-sm font-medium text-gray-700" for="nombre") Nombre *
            input#nombre(type="text" name="nombre" required value=(data ? data.nombre : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

          // Apellido
          div
            label(class="block text-sm font-medium text-gray-700" for="apellido") Apellido *
            input#apellido(type="text" name="apellido" required value=(data ? data.apellido : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

          // DNI
          div
            label(class="block text-sm font-medium text-gray-700" for="dni") DNI *
            input#dni(type="text" name="dni" required value=(data ? data.dni : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

          // Fecha Nacimiento
          div
            label(class="block text-sm font-medium text-gray-700" for="fecha_nacimiento") Fecha de Nacimiento *
            // Formateo de fecha para que se vea en el input type="date"
            - var fechaValue = data && data.fecha_nacimiento ? new Date(data.fecha_nacimiento).toISOString().split('T')[0] : ''
            input#fecha_nacimiento(type="date" name="fecha_nacimiento" required value=fechaValue class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

          // Sexo
          div
            label(class="block text-sm font-medium text-gray-700" for="sexo") Sexo *
            select#sexo(name="sexo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")
              option(value="" disabled selected=!data) Seleccione...
              option(value="F" selected=(data && data.sexo === 'F')) Femenino
              option(value="M" selected=(data && data.sexo === 'M')) Masculino
              option(value="X" selected=(data && data.sexo === 'X')) No Binario / Otro

          // Telefono
          div
            label(class="block text-sm font-medium text-gray-700" for="telefono") Teléfono
            input#telefono(type="tel" name="telefono" value=(data ? data.telefono : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

          // Dirección
          div(class="col-span-1 md:col-span-2")
            label(class="block text-sm font-medium text-gray-700" for="direccion") Dirección
            input#direccion(type="text" name="direccion" value=(data ? data.direccion : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

        h3(class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2") Datos de Cobertura

        div(class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6")
          // Obra Social
          div
            label(class="block text-sm font-medium text-gray-700" for="obra_social") Obra Social / Prepaga
            input#obra_social(type="text" name="obra_social" placeholder="Ej: PAMI, OSDE" value=(data ? data.obra_social : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

          // Numero Afiliado
          div
            label(class="block text-sm font-medium text-gray-700" for="numero_afiliado") Número de Afiliado
            input#numero_afiliado(type="text" name="numero_afiliado" value=(data ? data.numero_afiliado : '') class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border")

        // Botones
        div(class="flex justify-end pt-4")
          button(type="button" onclick="window.history.back()" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded mr-2") Cancelar
          button(type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg") #{isEditing ? 'Actualizar Paciente' : 'Guardar Paciente'}