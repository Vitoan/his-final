extends ../layouts/main

block content
  // --- HEADER ---
  div(class="max-w-4xl mx-auto mb-10")
    div(class="flex flex-col md:flex-row md:items-end justify-between gap-6")
      div
        h2(class="text-xs font-bold text-blue-500 dark:text-rose-500 mb-1 tracking-widest uppercase") Admisi√≥n
        h1(class="text-4xl font-bold tracking-tight text-slate-900 dark:text-white")
          | #{isEditing ? 'Editar' : 'Registrar'} <span class="text-blue-600 dark:text-rose-500">Paciente</span>
      
      a(href="/admision" class="text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-white font-bold text-sm flex items-center gap-2 transition-colors")
        span &larr;
        | Volver al Listado

  // --- FORMULARIO BENTO ---
  div(class="max-w-4xl mx-auto bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-[2rem] shadow-sm overflow-hidden p-8 md:p-10")

    // Mensaje de Error
    if error
      div(class="mb-8 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-300 px-4 py-3 rounded-xl text-sm font-medium flex items-center shadow-sm animate-pulse")
         span(class="mr-2 text-lg") ‚ö†Ô∏è
         | #{error}

    form(action=isEditing ? '/admision/editar/' + data.id : '/admision/nuevo' method="POST" class="space-y-10")
      
      // SECCI√ìN 1: DATOS PERSONALES
      div
        div(class="flex items-center gap-3 mb-6 border-b border-slate-100 dark:border-slate-700 pb-4")
          div(class="w-10 h-10 rounded-xl bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300 flex items-center justify-center text-xl") üë§
          h3(class="text-xl font-bold text-slate-800 dark:text-white") Datos Personales
        
        div(class="grid grid-cols-1 md:grid-cols-2 gap-6")
          // Nombre
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Nombre *
            input(type="text" name="nombre" required value=(data ? data.nombre : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm")

          // Apellido
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Apellido *
            input(type="text" name="apellido" required value=(data ? data.apellido : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm")

          // DNI
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") DNI *
            input(type="text" name="dni" required value=(data ? data.dni : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm font-mono")

          // Fecha Nacimiento
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Fecha de Nacimiento *
            - var fechaValue = data && data.fecha_nacimiento ? new Date(data.fecha_nacimiento).toISOString().split('T')[0] : ''
            input(type="date" name="fecha_nacimiento" required value=fechaValue class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm text-slate-600")

          // Sexo (Selector Moderno)
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Sexo *
            div(class="relative")
              select(name="sexo" required class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white appearance-none shadow-sm cursor-pointer")
                option(value="" disabled selected=!data) Seleccione...
                option(value="F" selected=(data && data.sexo === 'F')) Femenino
                option(value="M" selected=(data && data.sexo === 'M')) Masculino
                option(value="X" selected=(data && data.sexo === 'X')) No Binario / Otro
              
              // Flecha Custom
              div(class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-slate-500")
                 svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                    path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7")

          // Tel√©fono
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Tel√©fono
            input(type="tel" name="telefono" value=(data ? data.telefono : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm")

          // Direcci√≥n (Full width)
          div(class="col-span-1 md:col-span-2")
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Direcci√≥n
            input(type="text" name="direccion" value=(data ? data.direccion : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm")

      // SECCI√ìN 2: COBERTURA M√âDICA
      div
        div(class="flex items-center gap-3 mb-6 border-b border-slate-100 dark:border-slate-700 pb-4")
          div(class="w-10 h-10 rounded-xl bg-teal-100 text-teal-600 dark:bg-teal-900/30 dark:text-teal-300 flex items-center justify-center text-xl") üè•
          h3(class="text-xl font-bold text-slate-800 dark:text-white") Cobertura
        
        div(class="grid grid-cols-1 md:grid-cols-2 gap-6")
          // Obra Social
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") Obra Social / Prepaga
            input(type="text" name="obra_social" placeholder="Ej: PAMI, OSDE" value=(data ? data.obra_social : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm")

          // Numero Afiliado
          div
            label(class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2") N√∫mero de Afiliado
            input(type="text" name="numero_afiliado" value=(data ? data.numero_afiliado : '') class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 dark:focus:ring-rose-500 focus:border-transparent outline-none transition-all dark:text-white shadow-sm font-mono")

      // BOTONES DE ACCI√ìN
      div(class="pt-8 flex items-center justify-end gap-4 border-t border-slate-100 dark:border-slate-700 mt-6")
        button(type="button" onclick="window.history.back()" class="px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-bold transition-colors text-sm") 
           | Cancelar
        
        button(type="submit" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-3 rounded-xl hover:bg-slate-800 dark:hover:bg-slate-200 font-bold shadow-lg shadow-slate-500/20 transition-all transform active:scale-95 text-sm")
           | #{isEditing ? 'Actualizar Paciente' : 'Guardar Paciente'}