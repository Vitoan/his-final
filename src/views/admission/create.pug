extends ../layouts/main
include ../mixins/formPaciente

block content
  div(class="max-w-4xl mx-auto mb-10")
    div(class="flex flex-col md:flex-row md:items-end justify-between gap-6")
      div
        h2(class="text-xs font-bold text-blue-500 dark:text-rose-500 mb-1 tracking-widest uppercase") Admisi√≥n
        h1(class="text-4xl font-bold tracking-tight text-slate-900 dark:text-white")
          | #{isEditing ? 'Editar' : 'Registrar'} <span class="text-blue-600 dark:text-rose-500">Paciente</span>
      
      a(href="/admision" class="text-slate-500 hover:text-blue-600 dark:text-slate-400 dark:hover:text-white font-bold text-sm flex items-center gap-2 transition-colors")
        span &larr;
        | Volver al Listado

  div(class="max-w-4xl mx-auto bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-[2rem] shadow-sm overflow-hidden p-8 md:p-10")

    // --- ALERTAS DE ESTADO (Internado/Guardia) ---
    if data
      if data.Internacions && data.Internacions.length > 0
        div(class="mb-8 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-6 rounded-2xl flex items-start gap-4 animate-pulse")
           div(class="text-3xl") üõå
           div
             h3(class="text-lg font-bold text-red-800 dark:text-red-200") Paciente Actualmente Internado
             p(class="text-red-700 dark:text-red-300 text-sm mt-1")
               | Se encuentra en la 
               strong Habitaci√≥n #{data.Internacions[0].Cama.Habitacion.numero}
               | .

      else if data.Visita && data.Visita.length > 0
        div(class="mb-8 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-6 rounded-2xl flex items-start gap-4")
           div(class="text-3xl") üöë
           div
             h3(class="text-lg font-bold text-amber-800 dark:text-amber-200") En Sala de Espera / Guardia
             p(class="text-amber-700 dark:text-amber-300 text-sm mt-1")
               | Turno activo: 
               strong #{data.Visita[0].estado}

    if error
      div(class="mb-8 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-300 px-4 py-3 rounded-xl text-sm font-medium flex items-center shadow-sm animate-pulse")
         span(class="mr-2 text-lg") ‚ö†Ô∏è
         | #{error}

    // --- FORMULARIO CON MIXIN ---
    form(action=isEditing ? '/admision/editar/' + data.id : '/admision/nuevo' method="POST" class="space-y-10")
      
      div(class="flex items-center gap-3 mb-6 border-b border-slate-100 dark:border-slate-700 pb-4")
        div(class="w-10 h-10 rounded-xl bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300 flex items-center justify-center text-xl") üë§
        h3(class="text-xl font-bold text-slate-800 dark:text-white") Ficha de Paciente

      // AQU√ç USAMOS EL MIXIN M√ÅGICO ‚ú®
      +formPaciente(data, false)

      div(class="pt-8 flex items-center justify-end gap-4 border-t border-slate-100 dark:border-slate-700 mt-6")
        button(type="button" onclick="window.history.back()" class="px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-bold transition-colors text-sm") Cancelar
        button(type="submit" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-3 rounded-xl hover:bg-slate-800 dark:hover:bg-slate-200 font-bold shadow-lg shadow-slate-500/20 transition-all transform active:scale-95 text-sm") #{isEditing ? 'Actualizar Paciente' : 'Guardar Paciente'}