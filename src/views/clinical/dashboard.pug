extends ../layouts/main

block content
  div(class="flex justify-between items-center mb-8")
    div
      h1(class="text-3xl font-bold text-slate-800") Tablero Clínico
      p(class="text-slate-500") Pacientes activos e internados
    
    div(class="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200")
      span(class="font-bold text-teal-600 text-xl mr-2") #{pacientes.length}
      span(class="text-slate-500 text-sm") Pacientes en seguimiento

  // GRID DE PACIENTES
  if pacientes.length === 0
    div(class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded shadow-sm")
      p No hay pacientes internados actualmente.
  else
    div(class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6")
      each internacion in pacientes
        div(class="bg-white rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-all overflow-hidden flex flex-col")
          
          // Encabezado de la Tarjeta (Datos Paciente)
          div(class="p-5 border-b border-slate-50 bg-slate-50/50")
            div(class="flex justify-between items-start")
              div
                h3(class="text-lg font-bold text-slate-800") #{internacion.Paciente.nombre} #{internacion.Paciente.apellido}
                p(class="text-xs text-slate-500 font-mono mt-1") DNI: #{internacion.Paciente.dni}
              
              // Badge de Ubicación
              div(class="text-right")
                span(class="block text-xs font-bold text-teal-600 bg-teal-50 px-2 py-1 rounded-lg border border-teal-100")
                  | Hab #{internacion.Cama.Habitacion.numero}
                span(class="block text-xs text-slate-400 mt-1") Cama #{internacion.Cama.numero_cama}

          // Cuerpo (Última Evolución)
          div(class="p-5 flex-1")
            p(class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2") Última Evolución
            
            if internacion.Evolucions.length > 0
              - const ultimaEvo = internacion.Evolucions[0]
              div(class="bg-amber-50 border-l-2 border-amber-300 p-3 rounded text-sm text-slate-700 italic relative")
                // Comillas decorativas
                span(class="absolute top-0 left-1 text-2xl text-amber-200 font-serif leading-none") "
                p(class="pl-2") #{ultimaEvo.nota}
                
                div(class="mt-2 flex items-center justify-between")
                  span(class="text-xs text-slate-400") Hace #{Math.floor((new Date() - new Date(ultimaEvo.createdAt)) / (1000 * 60 * 60))} horas
                  span(class="text-xs font-bold text-teal-600") #{ultimaEvo.Autor ? ultimaEvo.Autor.nombre : 'Personal'}
            else
              div(class="text-center py-4 text-slate-400 text-sm")
                p Sin evoluciones registradas.
                p(class="text-xs opacity-70") Ingrese la primera nota.

          // Pie (Acciones)
          div(class="p-4 bg-slate-50 border-t border-slate-100 flex justify-between items-center")
            span(class="text-xs text-slate-400") Ingreso: #{new Date(internacion.fecha_ingreso).toLocaleDateString()}
            
            a(href=`/clinica/paciente/${internacion.id}` class="bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors shadow-lg shadow-slate-200")
              | Ver Historia →